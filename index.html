<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Controle Industrial</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f4f6f8;
    }

    #app {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
    }

    .login-screen {
      text-align: center;
      padding: 50px 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .dashboard header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #007bff;
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
    }

    .dashboard nav {
      margin: 20px 0;
    }

    .dashboard nav button {
      margin-right: 10px;
      padding: 10px 20px;
      border: none;
      background: #007bff;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      padding: 10px 20px;
      border: none;
      background: #28a745;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }

    .btn-logout {
      background: #dc3545;
    }

    .styled-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    .styled-table th, .styled-table td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    .styled-table tr:hover {
      background-color: #f1f1f1;
    }

    canvas {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="login-screen" id="loginScreen">
      <h2>Login</h2>
      <input type="email" id="email" placeholder="Email" />
      <input type="password" id="password" placeholder="Senha" />
      <button onclick="login()">Entrar</button>
      <button onclick="register()">Registrar</button>
    </div>

    <div class="dashboard" id="dashboard" style="display:none;">
      <header>
        <h2>Controle Industrial</h2>
        <button onclick="logout()" class="btn-logout">Sair</button>
      </header>

      <nav>
        <button onclick="showSection('cadastro')">Cadastro</button>
        <button onclick="showSection('analise')">An치lise</button>
        <button onclick="showSection('estoque')">Estoque</button>
      </nav>

      <!-- Cadastro -->
      <section id="cadastro" class="section active">
        <h3>Cadastro de M치quina</h3>
        <input type="text" id="maquina" placeholder="Nome da M치quina" />
        <input type="date" id="dataManutencao" />
        <input type="number" id="prazoPecas" placeholder="Prazo (dias)" />
        <input type="text" id="operador" placeholder="Operador" />
        <input type="number" id="producaoDia" placeholder="Produ칞칚o do Dia" />
        <input type="number" id="quebras" placeholder="Quebras" />
        <button onclick="salvarMaquina()">Salvar</button>
      </section>

      <!-- An치lise -->
      <section id="analise" class="section">
        <h3>An치lise Di치ria/Mensal</h3>
        <div>
          <button onclick="carregarAnalise('diaria')">Di치ria</button>
          <button onclick="carregarAnalise('mensal')">Mensal</button>
        </div>
        <table id="tabelaAnalise" class="styled-table"></table>
        <canvas id="graficoProducao" height="100"></canvas>
      </section>

      <!-- Estoque -->
      <section id="estoque" class="section">
        <h3>Estoque de Pe칞as</h3>
        <table id="tabelaEstoque" class="styled-table"></table>
      </section>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'hhttps://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    import { getFirestore, collection, addDoc, getDocs, query, where } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

    // 游댢 Configura칞칚o do Firebase - Substitua por sua pr칩pria!
    const firebaseConfig = {
  apiKey: "AIzaSyA1FPchcsdsyJWmOZUqfdbm-EbwkF01Awc",
  authDomain: "controle-4b27d.firebaseapp.com",
  projectId: "controle-4b27d",
  storageBucket: "controle-4b27d.firestorage.app",
  messagingSenderId: "194889796690",
  appId: "1:194889796690:web:c3162d4193252454fee38b"
};

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let registros = [];

    const loginScreen = document.getElementById("loginScreen");
    const dashboard = document.getElementById("dashboard");

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      signInWithEmailAndPassword(auth, email, password)
        .then(() => alert("Login bem-sucedido!"))
        .catch((error) => alert("Erro no login: " + error.message));
    }

    function register() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      createUserWithEmailAndPassword(auth, email, password)
        .then(() => alert("Conta criada com sucesso!"))
        .catch((error) => alert("Erro no registro: " + error.message));
    }

    function logout() {
      signOut(auth).then(() => alert("Voc칡 saiu."));
    }

    function showSection(id) {
      document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    async function salvarMaquina() {
      const maquina = document.getElementById("maquina").value;
      const dataManutencao = document.getElementById("dataManutencao").value;
      const prazoPecas = document.getElementById("prazoPecas").value;
      const operador = document.getElementById("operador").value;
      const producaoDia = document.getElementById("producaoDia").value;
      const quebras = document.getElementById("quebras").value;

      if (!maquina || !dataManutencao) return alert("Preencha os campos obrigat칩rios.");

      try {
        await addDoc(collection(db, "registros"), {
          maquina,
          dataManutencao,
          prazoPecas,
          operador,
          producaoDia,
          quebras,
          timestamp: new Date()
        });
        alert("Registro salvo!");
      } catch (e) {
        console.error("Erro ao salvar:", e);
      }
    }

    async function carregarRegistros() {
      const q = query(collection(db, "registros"));
      const snapshot = await getDocs(q);
      registros = [];
      snapshot.forEach(doc => {
        registros.push({ id: doc.id, ...doc.data() });
      });

      carregarEstoque();
    }

    function carregarAnalise(tipo = 'diaria') {
      const tabela = document.getElementById("tabelaAnalise");
      tabela.innerHTML = "";

      const headers = ["Data", "M치quina", "Operador", "Produ칞칚o", "Quebras"];
      const thead = document.createElement("thead");
      thead.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>`;
      tabela.appendChild(thead);

      const tbody = document.createElement("tbody");

      const hoje = new Date();
      let filtro;

      if (tipo === 'diaria') {
        filtro = (r) => {
          const data = r.timestamp.toDate();
          return (
            data.getDate() === hoje.getDate() &&
            data.getMonth() === hoje.getMonth() &&
            data.getFullYear() === hoje.getFullYear()
          );
        };
      } else if (tipo === 'mensal') {
        filtro = (r) => r.timestamp.toDate().getMonth() === hoje.getMonth();
      }

      const dadosFiltrados = registros.filter(filtro);

      dadosFiltrados.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${new Date(r.timestamp.seconds * 1000).toLocaleDateString()}</td>
          <td>${r.maquina}</td>
          <td>${r.operador}</td>
          <td>${r.producaoDia}</td>
          <td>${r.quebras}</td>
        `;
        tbody.appendChild(tr);
      });

      tabela.appendChild(tbody);

      atualizarGrafico(dadosFiltrados, tipo);
    }

    let grafico = null;

    function atualizarGrafico(data, tipo) {
      const ctx = document.getElementById("graficoProducao").getContext("2d");

      const labels = data.map((_, i) => `${tipo === "diaria" ? "Hoje" : "M칡s"} ${i + 1}`);
      const producao = data.map(r => r.producaoDia || 0);
      const quebras = data.map(r => r.quebras || 0);

      if (grafico) grafico.destroy();

      grafico = new Chart(ctx, {
        type: "bar",
        data: {
          labels,
          datasets: [
            {
              label: "Produ칞칚o",
              data: producao,
              backgroundColor: "#28a745"
            },
            {
              label: "Quebras",
              data: quebras,
              backgroundColor: "#dc3545"
            }
          ]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "top" },
            title: { display: true, text: `An치lise ${tipo === "diaria" ? "Di치ria" : "Mensal"}` }
          }
        }
      });
    }

    async function carregarEstoque() {
      const estoqueRef = collection(db, "estoque");
      const snapshot = await getDocs(estoqueRef);
      const tabela = document.getElementById("tabelaEstoque");
      tabela.innerHTML = "";

      const headers = ["Pe칞a", "Quantidade", "칔ltima Revis칚o"];
      const thead = document.createElement("thead");
      thead.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join("")}</tr>`;
      tabela.appendChild(thead);

      const tbody = document.createElement("tbody");

      snapshot.forEach(doc => {
        const p = doc.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.nome}</td>
          <td>${p.quantidade}</td>
          <td>${p.ultimaRevisao?.toDate().toLocaleDateString()}</td>
        `;
        tbody.appendChild(tr);
      });

      tabela.appendChild(tbody);
    }

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        loginScreen.style.display = "none";
        dashboard.style.display = "block";
        await carregarRegistros();
      } else {
        loginScreen.style.display = "block";
        dashboard.style.display = "none";
      }
    });
  </script>
</body>
</html>
